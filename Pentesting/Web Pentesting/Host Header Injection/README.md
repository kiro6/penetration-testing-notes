
# Content 
- [How to test for vulnerabilities using the HTTP Host header](#how-to-test-for-vulnerabilities-using-the-http-host-header)
  - [if it still route you for the target endpoint](#1-supply-an-arbitrary-host-header-if-it-still-route-you-for-the-target-endpoint--start-searching-for-functionality-that-use-the-supplied-host-header-you-injected-that-can-be-compromised)
  - [if it rediects you to another host or can not find the host (Invalid Host header) or blocked (Invalid Host header)](#2-supply-an-arbitrary-host-header-if-it-rediects-you-to-another-host-or-can-not-find-the-host-invalid-host-header-or-blocked-invalid-host-header-)
- [Techniques To Use](#techniques-to-use)
  - [injecting a payload via the port](#injecting-a-payload-via-the-port)
  - [advantage of a less-secure subdomain that you have already compromised](#advantage-of-a-less-secure-subdomain-that-you-have-already-compromised)
  - [Inject duplicate Host headers](#inject-duplicate-host-headers)
  - [Supply an absolute URL](#supply-an-absolute-url)
  - [Add line wrapping](#add-line-wrapping)
  - [Inject host override headers](#inject-host-override-headers)
- [Exploit the HTTP Host header](#exploit-the-http-host-header)
  - [password reset poisoning attack](#password-reset-poisoning-attack)
  - [Web cache poisoning](#web-cache-poisoning)
  - [Bypassing authentication](#bypassing-authentication)
  - [Accessing internal websites with virtual host brute-forcing](#accessing-internal-websites-with-virtual-host-brute-forcing)
  - [Routing-based SSRF](#routing-based-ssrf)
  - [Connection state attacks](#connection-state-attacks)
  - [SSRF via a malformed request line](#ssrf-via-a-malformed-request-line)

## How to test for vulnerabilities using the HTTP Host header
#### 1) Supply an arbitrary Host header if it still route you for the target endpoint => start searching for functionality that use the supplied host header you injected that can be compromised 
- Password reset poisoning 
- Web cache poisoning
- Exploiting classic server-side vulnerabilities  (Ex:sql,xxe)
- Routing-based SSRF => check if the host header send dns request for your server 
- Bypassing authentication
#### 2) Supply an arbitrary Host header if it rediects you to another host or can not find the host (Invalid Host header) or blocked (Invalid Host header) : 
- Connection state attacks
- Try to use [below techniques](#techniques-to-use) 
  
## Techniques To Use

#### injecting a payload via the port
```http
GET /example HTTP/1.1
Host: vulnerable-website.com:bad-stuff-here
```
#### advantage of a less-secure subdomain that you have already compromised
```http
GET /example HTTP/1.1
Host: hacked-subdomain.vulnerable-website.com
```
#### Inject duplicate Host headers
```http
GET /example HTTP/1.1
Host: vulnerable-website.com
Host: bad-stuff-here
```
#### Supply an absolute URL
```http
GET https://vulnerable-website.com/ HTTP/1.1
Host: bad-stuff-here
```

#### Add line wrapping
```http
GET /example HTTP/1.1
    Host: bad-stuff-here
Host: vulnerable-website.com
```

#### Inject host override headers
```http
GET /example HTTP/1.1
Host: vulnerable-website.com
X-Forwarded-Host: bad-stuff-here
```
- X-Forwarded-Host
- X-Host
- X-Forwarded-Server
- X-HTTP-Host-Override
- Forwarded

## Exploit the HTTP Host header
### password reset poisoning attack
 If the URL that is sent to the user is dynamically generated based on controllable input, such as the Host header, it may be possible to construct a password reset poisoning attack as follows:
- get victim's email address or username, as required, and submits a password reset request on their behalf.
- Modify the Host header so that it points to a domain that they control. (evil-user.net)
- The victim receives a password reset email directly from the website. contains a valid password reset token which its domain name in the URL points to the attacker's server: **https://evil-user.net/reset?token=0a1b2c3d4e5f6g7h8i9j**
- If the victim clicks this link (or it is fetched in some other way, for example, by an antivirus scanner) the password reset token will be delivered to the attacker's server.

In a real attack, the attacker may seek to increase the probability of the victim clicking the link by first warming them up with a fake breach notification 
for example: Even if you can't control the password reset link, you can sometimes use the Host header to inject HTML into sensitive emails. 

**Note:** that email clients typically don't execute JavaScript, but other HTML injection techniques like dangling markup attacks may still apply. 

### Web cache poisoning
- if you find that the Host header is reflected in the response markup without HTML-encoding, or even used directly in **script imports**. 
- if the target uses a web cache, it may be possible to turn this useless, reflected vulnerability into a dangerous, stored one by persuading the cache to serve a poisoned response to other users. 
### Bypassing authentication 
EX: flawed host header access control bypass : 
```http
GET /admin HTTP/1.1
Host: localhost
```
### Accessing internal websites with virtual host brute-forcing
```http
GET / HTTP/1.1
Host: intranet.example.com
```
### Routing-based SSRF
You can use a webhook to help identify these vulnerabilities. if receive a DNS lookup from the target server or another in-path system when you supply your domain , this indicates that you may be able to route requests to arbitrary domains. 
```http
GET https://VulnWebSite/admin HTTP/1.1
Host: 192.168.0.0
```
### Connection state attacks
```
Connection state attacks: 
For performance reasons, many websites reuse connections for multiple request/response cycles with the same client.
Poorly implemented HTTP servers sometimes work on the dangerous assumption that certain properties, such as the Host header, are identical for all HTTP/1.1 requests sent over the same connection.
This may be true of requests sent by a browser, but isn't necessarily the case for a sequence of requests sent from Burp Repeater. This can lead to a number of potential issues.

```
**EXAMPLE:**  
- you may occasionally encounter servers that only perform thorough validation on the first request they receive over a new connection.
- In this case, you can potentially bypass this validation by **sending an innocent-looking initial request then following up with your malicious one down the same connection**.

### SSRF via a malformed request line
Custom proxies sometimes fail to validate the request line properly, which can allow you to supply unusual, malformed input with unfortunate results. 
```http
GET @private-intranet/example HTTP/1.1
```
The resulting upstream URL will be:
```http
http://backend-server@private-intranet/example
```
which most HTTP libraries interpret as a request to access private-intranet with the username backend-server. 

