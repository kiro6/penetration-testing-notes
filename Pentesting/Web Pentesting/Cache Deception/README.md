## Web cache deception
Web cache deception is a vulnerability that enables an attacker to trick a web cache into storing sensitive, dynamic content. It's caused by discrepancies between how the cache server and origin server handle requests. 
- `Web cache poisoning` manipulates cache keys to inject malicious content into a cached response, which is then served to other users.
- `Web cache deception` exploits cache rules to trick the cache into storing sensitive or private content, which the attacker can then access.

Research: https://portswigger.net/research/gotta-cache-em-all


Black Hat USA 2024 : https://youtu.be/70yyOMFylUA?si=28MYiu8lpoQfzhrS

## Cache rules
- Static file extension rules - These rules match the file extension of the requested resource,
  - .css, .js.
- Static directory rules - These rules match all URL paths that start with a specific prefix. These are often used to target specific directories that contain only static resources,
  - /static, /assets, /wp-content, /media, /templates, /public, /shared
- File name rules - These rules match specific file names to target files that are universally required for web operations and change rarely,
  - such as robots.txt and favicon.ico.

## Detecting cached responses
- X-Cache header provides information about whether a response was served from the cache. Typical values include:
  - X-Cache: hit - The response was served from the cache.
  - X-Cache: miss - The cache did not contain a response for the request's key, so it was fetched from the origin server. In most cases, the response is then cached. To confirm this, send the request again to see whether the value updates to hit.
  - X-Cache: dynamic - The origin server dynamically generated the content. Generally this means the response is not suitable for caching.
  - X-Cache: refresh - The cached content was outdated and needed to be refreshed or revalidated.
- [Cache-Control](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Cache-Control) header may include a directive that indicates caching, like public with a max-age higher than 0. This only suggests that the resource is cacheable. It isn't always indicative of caching, as the cache may sometimes override this header.

# Exploiting Cache Deception
Identify a discrepancy in how the cache and origin server parse the URL path. This could be a discrepancy in how they:
- Map URLs to resources.
  - Path Params `/MyAccount/param1`
- Process delimiter characters.
  - `/ . ? : # [] @ ! $ & " () * + , ; =` 
- Normalize paths.
  - 

## Exploiting static extension cache rules
Cache rules often target static resources by matching common file extensions like `.css` or `.js` . This is the default behavior in most CDNs. 
### 1) Path mapping discrepancies
`http://example.com/path/resource/param1/param2` => `http://example.com/user/123/profile/wcd.css`
